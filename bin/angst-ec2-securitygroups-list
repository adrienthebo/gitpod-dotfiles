#!/bin/bash

if [[ -n "$DEBUG" ]]; then
    DEBUG_TAP="/dev/pts/2"
else
    DEBUG_TAP="/dev/null"
fi

vpc_id="$(aws ec2 describe-vpcs \
            --filters 'Name=tag:owner,Values=alt' \
            --query 'Vpcs[*].[VpcId, CidrBlock]' \
            | jq -r '.[0][0]')"

aws ec2 describe-security-groups \
    --filters "Name=vpc-id,Values=$vpc_id" \
    | tee $DEBUG_TAP \
    | jq '[.SecurityGroups[] | {GroupId,GroupName,Description,VpcId}]' \
    | jtbl